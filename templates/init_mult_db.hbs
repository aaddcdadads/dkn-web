#!/bin/bash

## 应用数据库初始化脚本

# 数据库初始化脚本所在目录
DB_WORKDIR={{dbConfig.workdir}}
# 服务器ip
DB_HOST={{dbConfig.dbHost}}
# 服务器用户
DB_USER={{dbConfig.dbUser}}
# 以项目编码作为数据库名称，会同步创建一个数据库同名用户
PROJECT_CODE={{projectCode}}
#应用数据库密码
DB_PASSWORD={{dbConfig.dbPassword}}
#模板数据库
DB_TEMPLATE={{dbConfig.sourceDb}}
#是否导入模板库数据(0:否,1:是)
IMPORT_DATA=1
# 微应用数据库名称，多个用逗号拼接
MICRO_DB_NAMES={{dbConfig.microDbNames}}
# 业务sql脚本文件(非必须)
SQL_FILE_PATH={{dbConfig.sqlPath}}

echo " 业务sql脚本文件: ${SQL_FILE_PATH} "
# 创建数据库、创建用户、拷贝模板库(表结构和数据)、创建微应用数据库并拷贝原微应用业务库表结构
ssh -t -t ${DB_USER}@${DB_HOST} "sh ${DB_WORKDIR}/init_app_db.sh ${PROJECT_CODE} ${DB_PASSWORD} ${DB_TEMPLATE} ${IMPORT_DATA} ${MICRO_DB_NAMES} ${SQL_FILE_PATH}"
