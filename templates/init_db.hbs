#!/bin/bash

#初始化微应用数据库脚本

# 数据库初始化工作目录
DB_WORKDIR={{dbWorkdir}}
# 服务器ip
DB_HOST={{dbConfig.dbHost}}
# 服务器用户
DB_USER={{dbConfig.dbUser}}
# 以项目编码作为数据库名称，会同步创建一个数据库同名用户
PROJECT_CODE={{projectCode}}
# 新创建的数据库密码
DB_PASS={{dbConfig.dbPassword}}
# 需要拷贝的源数据库名
SOURCE_DB={{dbConfig.sourceDb}}
# 业务sql脚本文件
SQL_FILE_PATH={{dbConfig.sqlPath}}

echo " 业务sql脚本文件: ${SQL_FILE_PATH} "
# 创建数据库、创建用户、拷贝模板库(表结构和数据)
ssh ${DB_HOST}@${DB_USER} "cd ${DB_WORKDIR} && ./init_db.sh ${PROJECT_CODE} ${DB_PASS} ${SOURCE_DB} 1 ${SQL_FILE_PATH}"

# 退出服务器
exit